import{v as u}from"./index-CctiBFVw.js";import{S as g,aa as h,e as D,Q as v,a3 as j}from"./index-CcR1OWpM.js";function S(d){const{context:a,particle:t,radius:n,opacity:i}=d,e=t.emojiData,r=2,c=n*r,m=a.globalAlpha;e&&(a.globalAlpha=i,a.drawImage(e,-n,-n,c,c),a.globalAlpha=m)}const x='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"';class b{constructor(){this._emojiShapeDict=new Map}destroy(){for(const[a,t]of this._emojiShapeDict)t instanceof ImageBitmap&&(t?.close(),this._emojiShapeDict.delete(a))}draw(a){S(a)}async init(a){const t=a.actualOptions;if(!u.find(e=>g(e,t.particles.shape.type)))return;const n=[h(x)],i=u.map(e=>t.particles.shape.options[e]).find(e=>!!e);i&&D(i,e=>{e.font&&n.push(h(e.font))}),await Promise.all(n)}particleDestroy(a){delete a.emojiData}particleInit(a,t){const i=t.shapeData;if(!i?.value)return;const e=v(i.value,t.randomIndexData),r=i.font??x;if(!e)return;const c=`${e}_${r}`,m=this._emojiShapeDict.get(c);if(m){t.emojiData=m;return}const p=j(t.size.value)*2;let f;const l=j(t.size.value);if(typeof OffscreenCanvas<"u"){const s=new OffscreenCanvas(p,p),o=s.getContext("2d");if(!o)return;o.font=`400 ${l*2}px ${r}`,o.textBaseline="middle",o.textAlign="center",o.fillText(e,l,l),f=s.transferToImageBitmap()}else{const s=document.createElement("canvas");s.width=p,s.height=p;const o=s.getContext("2d");if(!o)return;o.font=`400 ${l*2}px ${r}`,o.textBaseline="middle",o.textAlign="center",o.fillText(e,l,l),f=s}this._emojiShapeDict.set(c,f),t.emojiData=f}}export{b as EmojiDrawer};
