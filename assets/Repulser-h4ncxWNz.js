import{Repulse as T}from"./index-DSKmWuF8.js";import{E as _}from"./ExternalInteractorBase-CIi3zRdK.js";import{C as M,R as D}from"./Ranges-D1TI-l9V.js";import{W as O,O as b,X as w,L as S,a6 as C,q as P,t as H,S as g,Y as V,a2 as W}from"./index-CcR1OWpM.js";const v="repulse",F=0,L=6,A=3,I=2,B=0,X=0,Y=1,x=.5;class N extends _{constructor(l,n){super(n),this._clickRepulse=()=>{const t=this.container,s=t.actualOptions.interactivity.modes.repulse;if(!s)return;const e=t.repulse??{particles:[]};if(e.finish||(e.count||(e.count=0),e.count++,e.count===t.particles.count&&(e.finish=!0)),e.clicking){const i=t.retina.repulseModeDistance;if(!i||i<F)return;const r=Math.pow(i/L,A),u=t.interactivity.mouse.clickPosition;if(u===void 0)return;const o=new M(u.x,u.y,r),c=t.particles.quadTree.query(o,a=>this.isEnabled(a));for(const a of c){const{dx:p,dy:f,distance:m}=O(u,a.position),d=m**I,h=s.speed,k=-r*h/d;if(d<=r){e.particles.push(a);const R=b.create(p,f);R.length=k,a.velocity.setTo(R)}}}else if(e.clicking===!1){for(const i of e.particles)i.velocity.setTo(i.initialVelocity);e.particles=[]}},this._hoverRepulse=()=>{const t=this.container,s=t.interactivity.mouse.position,e=t.retina.repulseModeDistance;!e||e<B||!s||this._processRepulse(s,e,new M(s.x,s.y,e))},this._processRepulse=(t,s,e,i)=>{const r=this.container,u=r.particles.quadTree.query(e,h=>this.isEnabled(h)),o=r.actualOptions.interactivity.modes.repulse;if(!o)return;const{easing:c,speed:a,factor:p,maxSpeed:f}=o,m=w(c),d=(i?.speed??a)*p;for(const h of u){const{dx:k,dy:R,distance:y}=O(h.position,t),E=S(m(Y-y/s)*d,X,f),q=b.create(y?k/y*E:d,y?R/y*E:d);h.position.addTo(q)}},this._singleSelectorRepulse=(t,s)=>{const e=this.container,i=e.actualOptions.interactivity.modes.repulse;if(!i)return;const r=document.querySelectorAll(t);r.length&&r.forEach(u=>{const o=u,c=e.retina.pixelRatio,a={x:(o.offsetLeft+o.offsetWidth*x)*c,y:(o.offsetTop+o.offsetHeight*x)*c},p=o.offsetWidth*x*c,f=s.type==="circle"?new M(a.x,a.y,p):new D(o.offsetLeft*c,o.offsetTop*c,o.offsetWidth*c,o.offsetHeight*c),m=i.divs,d=C(m,o);this._processRepulse(a,p,f,d)})},this._engine=l,n.repulse||(n.repulse={particles:[]}),this.handleClickMode=t=>{const s=this.container.actualOptions,e=s.interactivity.modes.repulse;if(!e||t!==v)return;n.repulse||(n.repulse={particles:[]});const i=n.repulse;i.clicking=!0,i.count=0;for(const r of n.repulse.particles)this.isEnabled(r)&&r.velocity.setTo(r.initialVelocity);i.particles=[],i.finish=!1,setTimeout(()=>{n.destroyed||(i.clicking=!1)},e.duration*P)}}clear(){}init(){const l=this.container,n=l.actualOptions.interactivity.modes.repulse;n&&(l.retina.repulseModeDistance=n.distance*l.retina.pixelRatio)}interact(){const l=this.container,n=l.actualOptions,t=l.interactivity.status===H,s=n.interactivity.events,e=s.onHover,i=e.enable,r=e.mode,u=s.onClick,o=u.enable,c=u.mode,a=s.onDiv;t&&i&&g(v,r)?this._hoverRepulse():o&&g(v,c)?this._clickRepulse():V(v,a,(p,f)=>this._singleSelectorRepulse(p,f))}isEnabled(l){const n=this.container,t=n.actualOptions,s=n.interactivity.mouse,e=(l?.interactivity??t.interactivity).events,i=e.onDiv,r=e.onHover,u=e.onClick,o=W(v,i);if(!(o||r.enable&&s.position||u.enable&&s.clickPosition))return!1;const c=r.mode,a=u.mode;return g(v,c)||g(v,a)||o}loadModeOptions(l,...n){l.repulse||(l.repulse=new T);for(const t of n)l.repulse.load(t?.repulse)}reset(){}}export{N as Repulser};
