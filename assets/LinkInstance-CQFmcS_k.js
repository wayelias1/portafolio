import{K as b,W as q,n as T,m as C,J as O,H as S,a8 as D}from"./index-CcR1OWpM.js";import{g as L}from"./CanvasUtils-DL62Im12.js";function W(r,o,n,i){r.beginPath(),r.moveTo(o.x,o.y),r.lineTo(n.x,n.y),r.lineTo(i.x,i.y),r.closePath()}function R(r){let o=!1;const{begin:n,end:i,maxDistance:s,context:t,canvasSize:e,width:l,backgroundMask:d,colorLine:f,opacity:p,links:u}=r;if(b(n,i)<=s)L(t,n,i),o=!0;else if(u.warp){let a,g;const x={x:i.x-e.width,y:i.y},h=q(n,x);if(h.distance<=s){const c=n.y-h.dy/h.dx*n.x;a={x:0,y:c},g={x:e.width,y:c}}else{const c={x:i.x,y:i.y-e.height},y=q(n,c);if(y.distance<=s){const w=-(n.y-y.dy/y.dx*n.x)/(y.dy/y.dx);a={x:w,y:0},g={x:w,y:e.height}}else{const m={x:i.x-e.width,y:i.y-e.height},w=q(n,m);if(w.distance<=s){const F=n.y-w.dy/w.dx*n.x;a={x:-F/(w.dy/w.dx),y:F},g={x:a.x+e.width,y:a.y+e.height}}}}a&&g&&(L(t,n,a),L(t,i,g),o=!0)}if(!o)return;t.lineWidth=l,d.enable&&(t.globalCompositeOperation=d.composite),t.strokeStyle=T(f,p);const{shadow:k}=u;if(k.enable){const a=C(k.color);a&&(t.shadowBlur=k.blur,t.shadowColor=T(a))}t.stroke()}function z(r){const{context:o,pos1:n,pos2:i,pos3:s,backgroundMask:t,colorTriangle:e,opacityTriangle:l}=r;W(o,n,i,s),t.enable&&(o.globalCompositeOperation=t.composite),o.fillStyle=T(e,l),o.fill()}function E(r){return r.sort((o,n)=>o-n),r.join("_")}function M(r,o){const n=E(r.map(s=>s.id));let i=o.get(n);return i===void 0&&(i=O(),o.set(n,i)),i}const v=0,_=0,P=0,I=.5,K=1;class J{constructor(o){this.container=o,this._drawLinkLine=(n,i)=>{const s=n.options.links;if(!s?.enable)return;const t=this.container,e=t.actualOptions,l=i.destination,d=n.getPosition(),f=l.getPosition();let p=i.opacity;t.canvas.draw(u=>{let k;const a=n.options.twinkle?.lines;if(a?.enable){const c=a.frequency,y=C(a.color);O()<c&&y&&(k=y,p=S(a.opacity))}if(!k){const c=s.id!==void 0?t.particles.linksColors.get(s.id):t.particles.linksColor;k=D(n,l,c)}if(!k)return;const g=n.retina.linksWidth??_,x=n.retina.linksDistance??P,{backgroundMask:h}=e;R({context:u,width:g,begin:d,end:f,maxDistance:x,canvasSize:t.canvas.size,links:s,backgroundMask:h,colorLine:k,opacity:p})})},this._drawLinkTriangle=(n,i,s)=>{const t=n.options.links;if(!t?.enable)return;const e=t.triangles;if(!e.enable)return;const l=this.container,d=l.actualOptions,f=i.destination,p=s.destination,u=e.opacity??(i.opacity+s.opacity)*I;u<=v||l.canvas.draw(k=>{const a=n.getPosition(),g=f.getPosition(),x=p.getPosition(),h=n.retina.linksDistance??P;if(b(a,g)>h||b(x,g)>h||b(x,a)>h)return;let c=C(e.color);if(!c){const y=t.id!==void 0?l.particles.linksColors.get(t.id):l.particles.linksColor;c=D(n,f,y)}c&&z({context:k,pos1:a,pos2:g,pos3:x,backgroundMask:d.backgroundMask,colorTriangle:c,opacityTriangle:u})})},this._drawTriangles=(n,i,s,t)=>{const e=s.destination;if(!(n.links?.triangles.enable&&e.options.links?.triangles.enable))return;const l=e.links?.filter(d=>{const f=this._getLinkFrequency(e,d.destination);return e.options.links&&f<=e.options.links.frequency&&t.findIndex(u=>u.destination===d.destination)>=0});if(l?.length)for(const d of l){const f=d.destination;this._getTriangleFrequency(i,e,f)>n.links.triangles.frequency||this._drawLinkTriangle(i,s,d)}},this._getLinkFrequency=(n,i)=>M([n,i],this._freqs.links),this._getTriangleFrequency=(n,i,s)=>M([n,i,s],this._freqs.triangles),this._freqs={links:new Map,triangles:new Map}}drawParticle(o,n){const{links:i,options:s}=n;if(!i?.length)return;const t=i.filter(e=>s.links&&(s.links.frequency>=K||this._getLinkFrequency(n,e.destination)<=s.links.frequency));for(const e of t)this._drawTriangles(s,n,e,t),e.opacity>v&&(n.retina.linksWidth??_)>_&&this._drawLinkLine(n,e)}async init(){this._freqs.links=new Map,this._freqs.triangles=new Map,await Promise.resolve()}particleCreated(o){if(o.links=[],!o.options.links)return;const n=this.container.retina.pixelRatio,{retina:i}=o,{distance:s,width:t}=o.options.links;i.linksDistance=s*n,i.linksWidth=t*n}particleDestroyed(o){o.links=[]}}export{J as LinkInstance};
