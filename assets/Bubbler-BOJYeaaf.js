import{Bubble as x}from"./index-zjmnFAVM.js";import{L as M,K as _,q as S,a3 as m,t as D,A as j,Q as q,r as T,a4 as H,a5 as P,a6 as w,S as O,Y as L,a2 as A}from"./index-CcR1OWpM.js";import{E as W}from"./ExternalInteractorBase-CIi3zRdK.js";import{C as F,R as I}from"./Ranges-D1TI-l9V.js";import"./OptionsColor-DlmgYyDr.js";function E(y,o,e,n){if(o>=e){const b=y+(o-e)*n;return M(b,y,o)}else if(o<e){const b=y-(e-o)*n;return M(b,o,y)}}const v="bubble",g=0,K=0,Q=2,R=1,k=1,Y=0,G=0,C=.5,z=1;class $ extends W{constructor(o){super(o),this._clickBubble=()=>{const e=this.container,n=e.actualOptions,b=e.interactivity.mouse.clickPosition,s=n.interactivity.modes.bubble;if(!s||!b)return;e.bubble||(e.bubble={});const t=e.retina.bubbleModeDistance;if(!t||t<g)return;const l=e.particles.quadTree.queryCircle(b,t,i=>this.isEnabled(i)),{bubble:a}=e;for(const i of l){if(!a.clicking)continue;i.bubble.inRange=!a.durationEnd;const r=i.getPosition(),c=_(r,b),f=(new Date().getTime()-(e.interactivity.mouse.clickTime??K))/S;f>s.duration&&(a.durationEnd=!0),f>s.duration*Q&&(a.clicking=!1,a.durationEnd=!1);const d={bubbleObj:{optValue:e.retina.bubbleModeSize,value:i.bubble.radius},particlesObj:{optValue:m(i.options.size.value)*e.retina.pixelRatio,value:i.size.value},type:"size"};this._process(i,c,f,d);const p={bubbleObj:{optValue:s.opacity,value:i.bubble.opacity},particlesObj:{optValue:m(i.options.opacity.value),value:i.opacity?.value??R},type:"opacity"};this._process(i,c,f,p),!a.durationEnd&&c<=t?this._hoverBubbleColor(i,c):delete i.bubble.color}},this._hoverBubble=()=>{const e=this.container,n=e.interactivity.mouse.position,b=e.retina.bubbleModeDistance;if(!b||b<g||!n)return;const s=e.particles.quadTree.queryCircle(n,b,t=>this.isEnabled(t));for(const t of s){t.bubble.inRange=!0;const l=t.getPosition(),a=_(l,n),i=k-a/b;a<=b?i>=G&&e.interactivity.status===D&&(this._hoverBubbleSize(t,i),this._hoverBubbleOpacity(t,i),this._hoverBubbleColor(t,i)):this.reset(t),e.interactivity.status===j&&this.reset(t)}},this._hoverBubbleColor=(e,n,b)=>{const s=this.container.actualOptions,t=b??s.interactivity.modes.bubble;if(t){if(!e.bubble.finalColor){const l=t.color;if(!l)return;const a=q(l);e.bubble.finalColor=T(a)}if(e.bubble.finalColor)if(t.mix){e.bubble.color=void 0;const l=e.getFillColor();e.bubble.color=l?H(P(l,e.bubble.finalColor,k-n,n)):e.bubble.finalColor}else e.bubble.color=e.bubble.finalColor}},this._hoverBubbleOpacity=(e,n,b)=>{const s=this.container,t=s.actualOptions,l=b?.opacity??t.interactivity.modes.bubble?.opacity;if(!l)return;const a=e.options.opacity.value,i=e.opacity?.value??R,r=E(i,l,m(a),n);r!==void 0&&(e.bubble.opacity=r)},this._hoverBubbleSize=(e,n,b)=>{const s=this.container,t=b?.size?b.size*s.retina.pixelRatio:s.retina.bubbleModeSize;if(t===void 0)return;const l=m(e.options.size.value)*s.retina.pixelRatio,a=e.size.value,i=E(a,t,l,n);i!==void 0&&(e.bubble.radius=i)},this._process=(e,n,b,s)=>{const t=this.container,l=s.bubbleObj.optValue,a=t.actualOptions,i=a.interactivity.modes.bubble;if(!i||l===void 0)return;const r=i.duration,c=t.retina.bubbleModeDistance,f=s.particlesObj.optValue,d=s.bubbleObj.value,p=s.particlesObj.value??Y,u=s.type;if(!(!c||c<g||l===f))if(t.bubble||(t.bubble={}),t.bubble.durationEnd)d&&(u==="size"&&delete e.bubble.radius,u==="opacity"&&delete e.bubble.opacity);else if(n<=c){if((d??p)!==l){const h=p-b*(p-l)/r;u==="size"&&(e.bubble.radius=h),u==="opacity"&&(e.bubble.opacity=h)}}else u==="size"&&delete e.bubble.radius,u==="opacity"&&delete e.bubble.opacity},this._singleSelectorHover=(e,n,b)=>{const s=this.container,t=document.querySelectorAll(n),l=s.actualOptions.interactivity.modes.bubble;!l||!t.length||t.forEach(a=>{const i=a,r=s.retina.pixelRatio,c={x:(i.offsetLeft+i.offsetWidth*C)*r,y:(i.offsetTop+i.offsetHeight*C)*r},f=i.offsetWidth*C*r,d=b.type==="circle"?new F(c.x,c.y,f):new I(i.offsetLeft*r,i.offsetTop*r,i.offsetWidth*r,i.offsetHeight*r),p=s.particles.quadTree.query(d,u=>this.isEnabled(u));for(const u of p){if(!d.contains(u.getPosition()))continue;u.bubble.inRange=!0;const B=l.divs,h=w(B,i);(!u.bubble.div||u.bubble.div!==i)&&(this.clear(u,e,!0),u.bubble.div=i),this._hoverBubbleSize(u,z,h),this._hoverBubbleOpacity(u,z,h),this._hoverBubbleColor(u,z,h)}})},o.bubble||(o.bubble={}),this.handleClickMode=e=>{e===v&&(o.bubble||(o.bubble={}),o.bubble.clicking=!0)}}clear(o,e,n){o.bubble.inRange&&!n||(delete o.bubble.div,delete o.bubble.opacity,delete o.bubble.radius,delete o.bubble.color)}init(){const o=this.container,e=o.actualOptions.interactivity.modes.bubble;e&&(o.retina.bubbleModeDistance=e.distance*o.retina.pixelRatio,e.size!==void 0&&(o.retina.bubbleModeSize=e.size*o.retina.pixelRatio))}interact(o){const e=this.container.actualOptions,n=e.interactivity.events,b=n.onHover,s=n.onClick,t=b.enable,l=b.mode,a=s.enable,i=s.mode,r=n.onDiv;t&&O(v,l)?this._hoverBubble():a&&O(v,i)?this._clickBubble():L(v,r,(c,f)=>this._singleSelectorHover(o,c,f))}isEnabled(o){const e=this.container,n=e.actualOptions,b=e.interactivity.mouse,s=(o?.interactivity??n.interactivity).events,{onClick:t,onDiv:l,onHover:a}=s,i=A(v,l);return i||a.enable&&b.position||t.enable&&b.clickPosition?O(v,a.mode)||O(v,t.mode)||i:!1}loadModeOptions(o,...e){o.bubble||(o.bubble=new x);for(const n of e)o.bubble.load(n?.bubble)}reset(o){o.bubble.inRange=!1}}export{$ as Bubbler};
