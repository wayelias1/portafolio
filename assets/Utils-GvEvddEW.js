const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BZoK4boa.js","assets/index-CcR1OWpM.js","assets/index-BR72yemN.css"])))=>i.map(i=>d[i]);
import{_ as O}from"./index-CcR1OWpM.js";const R=[0,4,2,1],G=[8,8,4,2];class U{constructor(o){this.pos=0,this.data=new Uint8ClampedArray(o)}getString(o){const s=this.data.slice(this.pos,this.pos+o);return this.pos+=s.length,s.reduce((n,f)=>n+String.fromCharCode(f),"")}nextByte(){return this.data[this.pos++]}nextTwoBytes(){return this.pos+=2,this.data[this.pos-2]+(this.data[this.pos-1]<<8)}readSubBlocks(){let o="",s=0;const n=0,f=0;do{s=this.data[this.pos++];for(let a=s;--a>=n;o+=String.fromCharCode(this.data[this.pos++]));}while(s!==f);return o}readSubBlocksBin(){let o=this.data[this.pos],s=0;const n=0,f=1;for(let e=0;o!==n;e+=o+f,o=this.data[this.pos+e])s+=o;const a=new Uint8Array(s);o=this.data[this.pos++];for(let e=0;o!==n;o=this.data[this.pos++])for(let r=o;--r>=n;a[e++]=this.data[this.pos++]);return a}skipSubBlocks(){for(const o=1,s=0;this.data[this.pos]!==s;this.pos+=this.data[this.pos]+o);this.pos++}}const u={x:0,y:0},N=0,L=.5,$=0,A=0,z=0;function _(t,o){const s=[];for(let n=0;n<o;n++)s.push({r:t.data[t.pos],g:t.data[t.pos+1],b:t.data[t.pos+2]}),t.pos+=3;return s}function Q(t,o,s,n){switch(t.nextByte()){case 249:{const f=o.frames[s(!1)];t.pos++;const a=t.nextByte();f.GCreserved=(a&224)>>>5,f.disposalMethod=(a&28)>>>2,f.userInputDelayFlag=(a&2)===2;const e=(a&1)===1;f.delayTime=t.nextTwoBytes()*10;const r=t.nextByte();e&&n(r),t.pos++;break}case 255:{t.pos++;const f={identifier:t.getString(8),authenticationCode:t.getString(3),data:t.readSubBlocksBin()};o.applicationExtensions.push(f);break}case 254:{o.comments.push([s(!1),t.readSubBlocks()]);break}case 1:{if(o.globalColorTable.length===0)throw new EvalError("plain text extension without global color table");t.pos++,o.frames[s(!1)].plainTextData={left:t.nextTwoBytes(),top:t.nextTwoBytes(),width:t.nextTwoBytes(),height:t.nextTwoBytes(),charSize:{width:t.nextTwoBytes(),height:t.nextTwoBytes()},foregroundColor:t.nextByte(),backgroundColor:t.nextByte(),text:t.readSubBlocks()};break}default:t.skipSubBlocks();break}}async function W(t,o,s,n,f,a){const e=o.frames[n(!0)];e.left=t.nextTwoBytes(),e.top=t.nextTwoBytes(),e.width=t.nextTwoBytes(),e.height=t.nextTwoBytes();const r=t.nextByte(),w=(r&128)===128,g=(r&64)===64;e.sortFlag=(r&32)===32,e.reserved=(r&24)>>>3;const c=1<<(r&7)+1;w&&(e.localColorTable=_(t,c));const m=l=>{const{r:h,g:p,b:i}=(w?e.localColorTable:o.globalColorTable)[l];return l!==f(null)?{r:h,g:p,b:i,a:255}:{r:h,g:p,b:i,a:s?~~((h+p+i)/3):0}},C=(()=>{try{return new ImageData(e.width,e.height,{colorSpace:"srgb"})}catch(l){if(l instanceof DOMException&&l.name==="IndexSizeError")return null;throw l}})();if(C==null)throw new EvalError("GIF frame size is to large");const k=t.nextByte(),E=t.readSubBlocksBin(),x=1<<k,b=(l,h)=>{const p=l>>>3,i=l&7;return(E[p]+(E[p+1]<<8)+(E[p+2]<<16)&(1<<h)-1<<i)>>>i};if(g){for(let l=0,h=k+1,p=0,i=[[0]],I=0;I<4;I++)if(R[I]<e.height){let d=0,T=0,B=!1;for(;!B;){const D=l;if(l=b(p,h),p+=h+1,l===x){h=k+1,i.length=x+2;for(let y=0;y<i.length;y++)i[y]=y<x?[y]:[]}else{l>=i.length?i.push(i[D].concat(i[D][0])):D!==x&&i.push(i[D].concat(i[l][0]));for(const y of i[l]){const{r:F,g:v,b:P,a:M}=m(y);C.data.set([F,v,P,M],R[I]*e.width+G[I]*T+d%(e.width*4)),d+=4}i.length===1<<h&&h<12&&h++}d===e.width*4*(T+1)&&(T++,R[I]+G[I]*T>=e.height&&(B=!0))}}e.image=C,e.bitmap=await createImageBitmap(C)}else{let l=0,h=k+1,p=0,i=-4,I=!1;const d=[[0]];for(;!I;){const T=l;if(l=b(p,h),p+=h,l===x){h=k+1,d.length=x+2;for(let B=0;B<d.length;B++)d[B]=B<x?[B]:[]}else{if(l===x+1){I=!0;break}l>=d.length?d.push(d[T].concat(d[T][0])):T!==x&&d.push(d[T].concat(d[l][0]));for(const B of d[l]){const{r:D,g:y,b:F,a:v}=m(B);C.data.set([D,y,F,v],i+=4)}d.length>=1<<h&&h<12&&h++}}e.image=C,e.bitmap=await createImageBitmap(C)}}async function j(t,o,s,n,f,a){switch(t.nextByte()){case 59:return!0;case 44:await W(t,o,s,n,f);break;case 33:Q(t,o,n,f);break;default:throw new EvalError("undefined block found")}return!1}function q(t){for(const o of t.applicationExtensions)if(o.identifier+o.authenticationCode==="NETSCAPE2.0")return o.data[1]+(o.data[2]<<8);return NaN}async function H(t,o,s){s||(s=!1);const n=await fetch(t);if(!n.ok&&n.status===404)throw new EvalError("file not found");const f=await n.arrayBuffer(),a={width:0,height:0,totalTime:0,colorRes:0,pixelAspectRatio:0,frames:[],sortFlag:!1,globalColorTable:[],backgroundImage:new ImageData(1,1,{colorSpace:"srgb"}),comments:[],applicationExtensions:[]},e=new U(new Uint8ClampedArray(f));if(e.getString(6)!=="GIF89a")throw new Error("not a supported GIF file");a.width=e.nextTwoBytes(),a.height=e.nextTwoBytes();const r=e.nextByte(),w=(r&128)===128;a.colorRes=(r&112)>>>4,a.sortFlag=(r&8)===8;const g=1<<(r&7)+1,c=e.nextByte();a.pixelAspectRatio=e.nextByte(),a.pixelAspectRatio!==0&&(a.pixelAspectRatio=(a.pixelAspectRatio+15)/64),w&&(a.globalColorTable=_(e,g));const m=(()=>{try{return new ImageData(a.width,a.height,{colorSpace:"srgb"})}catch(i){if(i instanceof DOMException&&i.name==="IndexSizeError")return null;throw i}})();if(m==null)throw new Error("GIF frame size is to large");const{r:C,g:k,b:E}=a.globalColorTable[c];m.data.set(w?[C,k,E,255]:[0,0,0,0]);for(let i=4;i<m.data.length;i*=2)m.data.copyWithin(i,0,i);a.backgroundImage=m;let x=-1,b=!0,l=-1;const h=i=>(i&&(b=!0),x),p=i=>(i!=null&&(l=i),l);try{do b&&(a.frames.push({left:0,top:0,width:0,height:0,disposalMethod:0,image:new ImageData(1,1,{colorSpace:"srgb"}),plainTextData:null,userInputDelayFlag:!1,delayTime:0,sortFlag:!1,localColorTable:[],reserved:0,GCreserved:0}),x++,l=-1,b=!1);while(!await j(e,a,s,h,p,o));a.frames.length--;for(const i of a.frames){if(i.userInputDelayFlag&&i.delayTime===0){a.totalTime=1/0;break}a.totalTime+=i.delayTime}return a}catch(i){throw i instanceof EvalError?new Error(`error while parsing frame ${x} "${i.message}"`):i}}function K(t){const{context:o,radius:s,particle:n,delta:f}=t,a=n.image;if(!a?.gifData||!a.gif)return;const e=new OffscreenCanvas(a.gifData.width,a.gifData.height),r=e.getContext("2d");if(!r)throw new Error("could not create offscreen canvas context");r.imageSmoothingQuality="low",r.imageSmoothingEnabled=!1,r.clearRect(u.x,u.y,e.width,e.height),n.gifLoopCount===void 0&&(n.gifLoopCount=a.gifLoopCount??z);let w=n.gifFrame??N;const g={x:-a.gifData.width*L,y:-a.gifData.height*L},c=a.gifData.frames[w];if(n.gifTime===void 0&&(n.gifTime=$),!!c.bitmap){switch(o.scale(s/a.gifData.width,s/a.gifData.height),c.disposalMethod){case 4:case 5:case 6:case 7:case 0:r.drawImage(c.bitmap,c.left,c.top),o.drawImage(e,g.x,g.y),r.clearRect(u.x,u.y,e.width,e.height);break;case 1:r.drawImage(c.bitmap,c.left,c.top),o.drawImage(e,g.x,g.y);break;case 2:r.drawImage(c.bitmap,c.left,c.top),o.drawImage(e,g.x,g.y),r.clearRect(u.x,u.y,e.width,e.height),a.gifData.globalColorTable.length?r.putImageData(a.gifData.backgroundImage,g.x,g.y):r.putImageData(a.gifData.frames[A].image,g.x+c.left,g.y+c.top);break;case 3:{const m=r.getImageData(u.x,u.y,e.width,e.height);r.drawImage(c.bitmap,c.left,c.top),o.drawImage(e,g.x,g.y),r.clearRect(u.x,u.y,e.width,e.height),r.putImageData(m,u.x,u.y)}break}if(n.gifTime+=f.value,n.gifTime>c.delayTime){if(n.gifTime-=c.delayTime,++w>=a.gifData.frames.length){if(--n.gifLoopCount<=z)return;w=A,r.clearRect(u.x,u.y,e.width,e.height)}n.gifFrame=w}o.scale(a.gifData.width/s,a.gifData.height/s)}}async function V(t){if(t.type!=="gif"){const{loadImage:o}=await O(async()=>{const{loadImage:s}=await import("./index-BZoK4boa.js").then(n=>n.U);return{loadImage:s}},__vite__mapDeps([0,1,2]));await o(t);return}t.loading=!0;try{t.gifData=await H(t.source),t.gifLoopCount=q(t.gifData)??z,t.gifLoopCount||(t.gifLoopCount=1/0)}catch{t.error=!0}t.loading=!1}export{H as decodeGIF,K as drawGif,q as getGIFLoopAmount,V as loadGifImage};
